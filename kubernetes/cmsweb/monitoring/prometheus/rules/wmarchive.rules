groups:
- name: wmarchive
  rules:

  - alert: wmarchive service is down
    expr: avg_over_time(wma_uptime[5m]) < .9
    for: 5m
    labels:
      severity: high
      tag: cmsweb
      service: wmarchive
      action: Please restart wmarchive services
    annotations:
      summary: "wmarchive {{ $labels.env }} is down"
      description: "{{ $labels.env }} has been down for more than 5m"

  - alert: wmarchive high memory usage
    expr: avg_over_time(wma_memory_percent[5m]) > 90
    for: 5m
    labels:
      severity: high
      tag: cmsweb
      service: wmarchive
      action: Please restart wmarchive service
    annotations:
      summary: "wmarchive {{ $labels.env }} has high memory usage"
      description: "{{ $labels.env }} memory usage above 90% for more than 5m"

  - alert: wmarchive high cpu usage
    expr: avg_over_time(wma_cpu_percent[5m]) > 90
    for: 5m
    labels:
      severity: medium
      tag: cmsweb
      service: wmarchive
    annotations:
      summary: "wmarchive {{ $labels.env }} has high CPU usage"
      description: "{{ $labels.env }} CPU usage above 90% for more than 5m"
