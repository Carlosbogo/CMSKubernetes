service:
  type: NodePort

configMaps:
  carbon.conf: |-
    # cephfs does not support fallocate, and graphite
    # auto-detection isn't robust enough to tell, so we have to modify
    # WHISPER_FALLOCATE_CREATE = False
    # and I guess the rest of the config has to come along for the ride
    # (from https://github.com/kiwigrid/helm-charts/blob/master/charts/graphite/values.yaml )
    [cache]
    DATABASE = whisper
    ENABLE_LOGROTATION = True
    USER =
    MAX_CACHE_SIZE = inf
    MAX_UPDATES_PER_SECOND = 500
    MAX_CREATES_PER_MINUTE = 50
    MIN_TIMESTAMP_RESOLUTION = 1
    LINE_RECEIVER_INTERFACE = 0.0.0.0
    LINE_RECEIVER_PORT = 2003
    UDP_RECEIVER_INTERFACE = 0.0.0.0
    UDP_RECEIVER_PORT = 2003
    PICKLE_RECEIVER_INTERFACE = 0.0.0.0
    PICKLE_RECEIVER_PORT = 2004
    USE_INSECURE_UNPICKLER = False
    CACHE_QUERY_INTERFACE = 0.0.0.0
    CACHE_QUERY_PORT = 7002
    USE_FLOW_CONTROL = True
    LOG_UPDATES = False
    LOG_CREATES = False
    LOG_CACHE_HITS = False
    CACHE_WRITE_STRATEGY = sorted
    WHISPER_AUTOFLUSH = False
    CARBON_METRIC_INTERVAL = 10
    GRAPHITE_URL = http://127.0.0.1:8080
    # Non-standard:
    WHISPER_FALLOCATE_CREATE = False
    ENABLE_UDP_LISTENER = True
    LOG_CACHE_QUEUE_SORTS = True
    USE_WHITELIST = True
    [relay]
    LINE_RECEIVER_INTERFACE = 0.0.0.0
    LINE_RECEIVER_PORT = 2013
    PICKLE_RECEIVER_INTERFACE = 0.0.0.0
    PICKLE_RECEIVER_PORT = 2014
    RELAY_METHOD = rules
    REPLICATION_FACTOR = 1
    DESTINATIONS = 127.0.0.1:2004
    MAX_QUEUE_SIZE = 10000
    MAX_DATAPOINTS_PER_MESSAGE = 500
    QUEUE_LOW_WATERMARK_PCT = 0.8
    TIME_TO_DEFER_SENDING = 0.0001
    USE_FLOW_CONTROL = True
    CARBON_METRIC_INTERVAL = 10
    USE_RATIO_RESET=False
    MIN_RESET_STAT_FLOW=1000
    MIN_RESET_RATIO=0.9
    MIN_RESET_INTERVAL=121
    [aggregator]
    LINE_RECEIVER_INTERFACE = 0.0.0.0
    LINE_RECEIVER_PORT = 2023
    PICKLE_RECEIVER_INTERFACE = 0.0.0.0
    PICKLE_RECEIVER_PORT = 2024
    FORWARD_ALL = True
    DESTINATIONS = 127.0.0.1:2004
    REPLICATION_FACTOR = 1
    MAX_QUEUE_SIZE = 10000
    USE_FLOW_CONTROL = True
    MAX_DATAPOINTS_PER_MESSAGE = 500
    MAX_AGGREGATION_INTERVALS = 5
    CARBON_METRIC_INTERVAL = 10
  blacklist.conf: |-
    # ATLAS blacklist
    ^.*90$
    ^.*sum_squares$
    ^.*median$
    ^.*std$
  storage-schemas.conf: |-
    [carbon]
    pattern = ^carbon\.
    retentions = 10s:6h,1m:90d

    [http_monitoring]
    pattern = rucio.http-monitoring.*
    retentions = 1m:30d,60m:5y

    [default_1min_for_1day]
    pattern = .*
    retentions = 10s:6h,1m:6d,10m:30d,60m:5y
